# RiderFlow PRD (v1.1)

## 1. 개요

- 목적: 본사-지사 구조의 배달 라이더 정산 데이터를 통합 관리하고, 엑셀 기반 정산 프로세스를 자동화하여 운영 효율을 극대화한다.
- 대상 플랫폼: Web (Next.js 14+ App Router + Supabase + TailwindCSS).
- 사용자: 루트 관리자(시스템 운영자), 본사 관리자, 지사 관리자.
- 특이사항: 라이더는 직접 로그인하지 않으며, 관리자가 등록/관리하는 엔티티로 존재한다.

## 2. 핵심 가치 및 문제 정의

- 문제: 지사별로 다른 엑셀 양식, 수동 수익 계산의 번거로움, 라이더별 정산 내역 전달의 어려움.
- 해결:
  - 엑셀 업로드 시 (이름 + 전화번호 + 고유 ID) 기반의 정밀 매칭.
  - 건당 단가 기반의 총 수익, 주간/월간 수익 자동 계산.
  - 관리자가 계정을 생성하고 초대 이메일을 통해 보안성 높은 계정 전달.

## 3. 핵심 원칙

- 계정 생성: 직접 회원가입 기능은 제공하지 않는다. 루트 관리자가 생성한 초대 링크를 통해서만 계정 생성이 가능하다.
- 데이터 격리: Supabase RLS를 통해 본사(Agency) 및 지사(Branch) 단위의 엄격한 데이터 접근 제어를 수행한다.
- 엑셀 처리: 엑셀 원본은 저장하지 않으며, 파싱된 정산 데이터만 저장한다.
- UI/UX: Shadcn/UI 및 Base UI를 활용하여 모던하고 직관적인 대시보드를 제공한다.

## 4. 기능 요구사항 (V1)

### 4.1 계정 및 권한 관리

- 초대 시스템: 루트 관리자가 관리자 이메일로 초대장 발송 -> 사용자가 링크 클릭 후 비밀번호 설정.
- 조직 구조: Root -> Agency (Company) -> Branch 의 3단계 계층 구조 지원.

### 4.2 엑셀 업로드 및 정산 (핵심)

- 정밀 매칭: 엑셀의 `이름`, `전화번호`, `고유 ID`를 조합하여 DB의 라이더와 매칭.
- 자동 계산: DB에는 기초 수치만 저장하고, Supabase Edge Functions를 통해 총 수익 및 주간/월간 집계를 실시간으로 계산.
- 검증: 필수 컬럼 누락 및 데이터 형식 오류 시 업로드 세션에서 즉시 오류 리스트 제공.

### 4.3 대시보드 및 통계

- KPI 시각화: 총 수익, 순수익, 출근자/휴무자 수 실시간 요약.
- 추이 분석: 일자별/주간 수익 그래프 제공.
- 기사 랭킹: 수익 및 건수 기준 상위 라이더 표시.

### 4.4 라이더 관리

- 상태 업데이트: 지사 관리자가 라이더의 근무/휴무/제거 상태를 직접 관리.
- 매핑: 라이더와 지사 간의 다대다(N:M) 매핑 지원 (현재 활성 지사 관리).

### 4.5 알림 서비스 (Placeholder)

- 정산 이미지: 라이더에게 전송할 일일 정산 이미지를 생성하고 발송 현황을 관리 (발송 방식 추후 확정).

## 5. 기술 스택

- Framework: Next.js 14 (App Router)
- Styling: Tailwind CSS, Shadcn/UI, Base UI
- Database/Auth: Supabase (PostgreSQL, RLS, Auth API)
- Icons: Lucide React
- Excel Library: `xlsx` (SheetJS)

## 6. 사용자 플로우

1. 루트 관리자: 본사/지사 생성 및 관리자 초대 이메일 발송.
2. 지사 관리자: 이메일 수신 후 비밀번호 설정 및 로그인.
3. 지사 관리자: 라이더 명단 등록 및 상태 설정.
4. 지사 관리자: 정기적으로 정산 엑셀 업로드 -> 시스템 자동 계산 및 적재.
5. 관리자 공통: 대시보드를 통해 정산 지표 및 기사별 수익 확인.
